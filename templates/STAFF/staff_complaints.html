{% extends "STAFF/commen.html" %}
{% block content %}

<div class="container mt-4">
    <h3>Welcome, {{ staff.name }}</h3>
    <hr>

    <table class="table table-bordered table-hover shadow-sm">
        <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Citizen</th>
                <th>Subject</th>
                <th>Image</th>
                <th>Status</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for c in complaints %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ c.citizen.name }}</td>
                <td>{{ c.title }}</td>
                <td>
                    {% if c.damaged_image %}
                    <a href="{{ c.damaged_image.url }}" target="_blank">
                        <img src="{{ c.damaged_image.url }}" alt="Complaint Image"
                            style="max-width: 80px; max-height: 80px; cursor: pointer;" class="img-thumbnail">
                    </a>
                    {% else %}
                    <span class="text-muted">No image</span>
                    {% endif %}
                </td>
                <td>
                    {% if c.status == "Pending" %}
                    <span class="badge bg-warning text-dark">{{ c.status }}</span>
                    {% elif c.status == "Ongoing" %}
                    <span class="badge bg-info text-dark">{{ c.status }}</span>
                    {% elif c.status == "Completed" %}
                    <span class="badge bg-success">{{ c.status }}</span>
                    {% else %}
                    <span class="badge bg-secondary">{{ c.status }}</span>
                    {% endif %}
                </td>
                <td>{{ c.created_at|date:"d M Y H:i" }}</td>
                <td>
                    {% if c.worker %}
                    <span class="text-primary">{{ c.worker.name }}</span>
                    {% else %}
                    <a href="/staff_assign_worker/?id={{ c.id }}" class="btn btn-sm btn-outline-primary">Assign
                        Worker</a>
                    {% endif %}
                </td>
                <td>
                    <a href="/staff_complaint_detail/?id={{ c.id }}" class="btn btn-sm btn-info me-1">View Details</a>
                    <!-- POST form to add complaint action -->
                    <form method="POST" action="/staff_add_complaint_action/" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="complaint_id" value="{{ c.id }}">
                        <button type="submit" class="btn btn-sm btn-primary">Take Action</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-muted">No complaints found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}